<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Now - Instant Quote & Payment | Maid For Heaven NYC</title>
    <!-- Navigation links updated - cache bust v2.0 -->
    <link rel="stylesheet" href="css/styles.css?v=20250716mobile004">
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    <!-- EmailJS for sending confirmation emails -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        (function(){
            // Initialize EmailJS with your public key
            emailjs.init("EfMM8bLysLDO-P5si");
        })();
    </script>
    <style>
        /* Booking Page Specific Styles */
        .booking-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }
        
        .booking-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .booking-header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .booking-header h1 {
            margin: 0 0 8px 0;
            font-size: 1.6rem;
        }
        
        .booking-header p {
            font-size: 0.95rem;
            margin: 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }
        
        .service-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .service-option {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
        }
        
        .service-option:hover {
            border-color: #4CAF50;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.2);
        }
        
        .service-option.selected {
            border-color: #4CAF50 !important;
            background: #f8fff8 !important;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3) !important;
            border: 2px solid #4CAF50 !important;
        }
        
        .service-icon {
            font-size: 1.6rem;
            background: #4CAF50;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .service-info {
            flex: 1;
        }
        
        .service-info h3 {
            margin: 0 0 4px 0;
            color: #333;
            font-size: 1.1rem;
        }
        
        .service-info p {
            margin: 0;
            color: #666;
            font-size: 0.85rem;
        }
        
        .service-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4CAF50;
        }
        
        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .quote-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
        }
        
        .quote-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .quote-header h2 {
            margin: 0 0 6px 0;
            font-size: 1.4rem;
        }
        
        .quote-header p {
            font-size: 0.9rem;
            margin: 0;
        }
        
        .quote-display {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 16px;
        }
        
        .quote-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .quote-total {
            border-top: 2px solid #4CAF50;
            padding-top: 12px;
            margin-top: 12px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .quote-details {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e0e0e0;
            color: #666;
            font-size: 0.85rem;
        }
        
        .book-now-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .book-now-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        /* Calendar Conflict Detection Styles */
        /* Payment Method Styles */
        .payment-methods {
            margin: 25px 0;
        }
        
        .payment-method {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
        }
        
        .payment-method:hover {
            border-color: #4CAF50 !important;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
            transform: translateY(-2px);
        }
        
        .payment-method.selected {
            border-color: #4CAF50 !important;
            background: #f8fff8 !important;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .payment-method input[type="radio"] {
            width: auto;
            margin-right: 15px;
            transform: scale(1.2);
        }
        
        /* Payment Modal Styles */
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .payment-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .pay-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .pay-button:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .conflict-container {
            margin: 15px 0;
        }
        
        .conflict-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .conflict-warning h4 {
            color: #856404;
            margin: 0 0 10px 0;
            font-size: 1.1rem;
        }
        
        .conflict-warning p {
            color: #856404;
            margin: 5px 0;
        }
        
        .conflict-warning ul {
            color: #856404;
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .conflict-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .conflict-success p {
            color: #155724;
            margin: 0;
            font-weight: 500;
        }
        
        .alternatives {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ffeaa7;
        }
        
        .alternative-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 5px 5px 5px 0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }
        
        .alternative-btn:hover {
            background: #45a049;
        }
        .conflict-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        
        .conflict-message {
            color: #856404;
        }
        
        .conflict-message strong {
            color: #d63031;
        }
        
        .conflict-message ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .conflict-message li {
            margin-bottom: 5px;
        }
        
        .alternative-slots {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ffeaa7;
        }
        
        .alternatives-message {
            color: #155724;
        }
        
        .alternative-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .alternative-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }
        
        .alternative-btn:hover {
            background: #218838;
        }
        
        .schedule-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        
        .success-message {
            color: #155724;
        }
        
        .schedule-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        
        .error-message {
            color: #721c24;
        }
        
        
        .book-now-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .features-list {
            margin-top: 30px;
        }
        
        .features-list h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .feature-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .feature-icon {
            font-size: 1.5rem;
            margin-top: 2px;
        }
        
        .feature-item strong {
            color: #333;
            display: block;
            margin-bottom: 3px;
        }
        
        .feature-item p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Payment Modal Styles */
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .payment-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .close-modal {
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }
        
        .payment-booking-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .summary-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .total-line {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .payment-methods {
            margin-bottom: 25px;
        }
        
        .payment-method {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }
        
        .payment-method.selected {
            border-color: #4CAF50;
            background: #f8fff8;
        }
        
        .pay-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .payment-success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        /* Credit Card Form Styles */
        .credit-card-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4CAF50;
        }
        
        .credit-card-form h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 1.2rem;
        }
        
        .card-row {
            margin-bottom: 15px;
        }
        
        .card-field {
            width: 100%;
        }
        
        .card-field-half {
            width: 48%;
            display: inline-block;
            margin-right: 2%;
        }
        
        .card-field-quarter {
            width: 23%;
            display: inline-block;
            margin-right: 2%;
        }
        
        .card-field-quarter:last-child {
            margin-right: 0;
        }
        
        .card-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }
        
        .card-field input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        .card-field input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        #card-element {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            transition: border-color 0.3s ease;
        }
        
        #card-element:focus-within {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        #card-errors {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .booking-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .quote-section {
                position: static;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="nav-brand">
                    <a href="index.html">Maid For Heaven NYC</a>
                </div>
                <nav class="nav-menu">
                    <a href="index.html">HOME</a>
                    <a href="index.html#services">SERVICES</a>
                    <a href="index.html#about">ABOUT</a>
                    <a href="faq.html">FAQ</a>
                    <a href="contact-us.html">CONTACT</a>
                </nav>
                <div class="nav-contact">
                    <a href="tel:+13477592000" class="phone-link">(347) 759-2000</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="booking-container">
            <!-- Left Column - Booking Form -->
            <div class="booking-form">
                <div class="booking-header">
                    <h1>📅 Book Your Cleaning Service</h1>
                    <p>Get instant pricing with no hidden fees. Professional cleaning team.</p>
                </div>

                <!-- Service Type -->
                <div class="form-group">
                    <label>Service Type</label>
                    <div class="service-options">
                        <div class="service-option" data-service="standard" data-price="50">
                            <div class="service-icon">🏠</div>
                        <div class="service-info">
                            <h3>Standard Cleaning</h3>
                            <p>Regular maintenance cleaning for your home</p>
                        </div>
                        <div class="service-price">$50/hr</div>
                        </div>
                        <div class="service-option" data-service="deep" data-price="55">
                            <div class="service-icon">✨</div>
                            <div class="service-info">
                                <h3>Deep Cleaning</h3>
                                <p>Thorough cleaning including baseboards, inside appliances</p>
                            </div>
                            <div class="service-price">Flat Rate</div>
                        </div>
                        <div class="service-option" data-service="moveout" data-price="0">
                            <div class="service-icon">📦</div>
                            <div class="service-info">
                                <h3>Move-Out Cleaning</h3>
                                <p>Complete cleaning for moving out or post-construction</p>
                            </div>
                            <div class="service-price">Flat Rate</div>
                        </div>
                        <div class="service-option" data-service="movein" data-price="0">
                            <div class="service-icon">🏡</div>
                            <div class="service-info">
                                <h3>Move-In Cleaning</h3>
                                <p>Deep cleaning for your new home before moving in</p>
                            </div>
                            <div class="service-price">Flat Rate</div>
                        </div>
                    </div>
                </div>

                <!-- Property Details -->
                <div class="form-group">
                    <label for="bedrooms">Bedrooms</label>
                    <select id="bedrooms" required>
                        <option value="">Select bedrooms</option>
                        <option value="studio">Studio</option>
                        <option value="1br">1 Bedroom</option>
                        <option value="2br">2 Bedrooms</option>
                        <option value="3br">3 Bedrooms</option>
                        <option value="4br">4 Bedrooms</option>
                        <option value="5br">5+ Bedrooms</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bathrooms">Bathrooms</label>
                    <select id="bathrooms" required>
                        <option value="">Select bathrooms</option>
                        <option value="1">1 Bathroom</option>
                        <option value="1.5">1.5 Bathrooms</option>
                        <option value="2">2 Bathrooms</option>
                        <option value="2.5">2.5 Bathrooms</option>
                        <option value="3">3 Bathrooms</option>
                        <option value="3.5">3.5 Bathrooms</option>
                        <option value="4">4+ Bathrooms</option>
                    </select>
                </div>

                <!-- Date and Time -->
                <div class="form-group">
                    <label for="preferredDate">Preferred Date</label>
                    <input type="date" id="preferredDate" required>
                </div>

                <div class="form-group">
                    <label for="preferredTime">Preferred Time</label>
                    <select id="preferredTime" required>
                        <option value="">Select time</option>
                        <option value="morning">Morning (8:00 AM - 12:00 PM)</option>
                        <option value="afternoon">Afternoon (12:00 PM - 5:00 PM)</option>
                        <option value="evening">Evening (5:00 PM - 8:00 PM)</option>
                    </select>
                </div>

                <!-- Frequency -->
                <div class="form-group" id="frequency-group">
                    <label for="frequency">Cleaning Frequency</label>
                    <select id="frequency" required>
                        <option value="">Select frequency</option>
                        <option value="one-time">One-time cleaning</option>
                        <option value="weekly">Weekly</option>
                        <option value="bi-weekly">Bi-weekly (every 2 weeks)</option>
                        <option value="monthly">Monthly</option>
                        <option value="custom">Custom schedule</option>
                    </select>
                </div>

                <!-- Address -->
                <div class="form-group">
                    <label for="address">Service Address</label>
                    <input type="text" id="address" placeholder="Enter your full address" required>
                </div>

                <!-- Contact Information -->
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" placeholder="Enter your full name" required>
                </div>

                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" placeholder="Enter your phone number" required>
                </div>

                <!-- Special Instructions -->
                <div class="form-group">
                    <label for="instructions">Special Instructions (Optional)</label>
                    <textarea id="instructions" rows="3" placeholder="Any special requests or areas of focus?"></textarea>
                </div>
            </div>

            <!-- Right Column - Quote and Booking -->
            <div class="quote-section">
                <div class="quote-header">
                    <h2>💰 Instant Quote</h2>
                    <p>Professional cleaning with 100% satisfaction guarantee</p>
                </div>

                <div class="quote-display">
                    <div class="quote-line">
                        <span>Service Type:</span>
                        <span id="quoteService">Select service</span>
                    </div>
                    <div class="quote-line">
                        <span>Property Size:</span>
                        <span id="quoteSize">Select bedrooms</span>
                    </div>
                    <div class="quote-line">
                        <span>Estimated Time:</span>
                        <span id="quoteTime">-- hours</span>
                    </div>
                    <div class="quote-line">
                        <span>Frequency:</span>
                        <span id="quoteFrequency">Select frequency</span>
                    </div>
                    <div class="quote-line">
                        <span>Hourly Rate:</span>
                        <span id="quoteRate">$--/hr</span>
                    </div>
                    <div class="quote-line quote-total">
                        <span>Total Price:</span>
                        <span id="quoteTotal">$0.00</span>
                    </div>
                </div>

                <!-- Calendar Conflict Detection -->
                <div id="conflictContainer" class="conflict-container"></div>

                <button id="bookNowBtn" class="book-now-btn" disabled>
                    Complete Form to Book
                </button>

                <div class="quote-details">
                </div>

                <!-- Features List -->
                <div class="features-list">
                    <h3>🌟 Why Choose Maid For Heaven NYC?</h3>
                    
                    <div class="feature-item">
                        <div class="feature-icon">🛡️</div>
                        <div>
                            <strong>Fully Insured & Bonded</strong>
                            <p>Complete protection for your home and belongings</p>
                        </div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">⭐</div>
                        <div>
                            <strong>5-Star Rated Service</strong>
                            <p>Consistently rated #1 cleaning service in NYC</p>
                        </div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">🧽</div>
                        <div>
                            <strong>Eco-Friendly Products</strong>
                            <p>Safe, non-toxic cleaning supplies for your family</p>
                        </div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">💯</div>
                        <div>
                            <strong>Satisfaction Guarantee</strong>
                            <p>Not happy? We'll return within 24 hours to make it right</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Payment Modal -->
    <div id="paymentModal" class="payment-modal">
        <div class="payment-modal-content">
            <div class="payment-header">
                <h2>💳 Complete Your Booking</h2>
                <span class="close-modal" onclick="closePaymentModal()">&times;</span>
            </div>
            
            <div class="payment-booking-summary">
                <div class="summary-line">
                    <span>Service:</span>
                    <span id="paymentService">--</span>
                </div>
                <div class="summary-line">
                    <span>Date & Time:</span>
                    <span id="paymentDateTime">--</span>
                </div>
                <div class="summary-line">
                    <span>Address:</span>
                    <span id="paymentAddress">--</span>
                </div>
                <div class="summary-line">
                    <span>Estimated Duration:</span>
                    <span id="paymentDuration">-- hours</span>
                </div>
                <div class="summary-line total-line">
                    <span>Total Amount:</span>
                    <span id="paymentTotal">$0.00</span>
                </div>
            </div>
            
            <div class="payment-methods">
                <h3>Choose Payment Method:</h3>
                
                <div class="payment-method" data-method="card">
                    <input type="radio" name="payment" value="card" id="cardPayment">
                    <label for="cardPayment">
                        <strong>💳 Credit/Debit Card</strong><br>
                        <small>Secure online payment</small>
                    </label>
                </div>
                
                <div class="payment-method" data-method="paypal">
                    <input type="radio" name="payment" value="paypal" id="paypalPayment">
                    <label for="paypalPayment">
                        <strong>🅿️ PayPal</strong><br>
                        <small>Pay with your PayPal account</small>
                    </label>
                </div>
                
                <div class="payment-method" data-method="later">
                    <input type="radio" name="payment" value="later" id="laterPayment">
                    <label for="laterPayment">
                        <strong>💰 Venmo/Zelle</strong><br>
                        <small>Book now, pay on service day</small>
                    </label>
                </div>
            </div>
            
            <!-- Credit Card Form (hidden by default) -->
            <div id="creditCardForm" class="credit-card-form" style="display: none;">
                <h3>💳 Credit Card Information</h3>
                
                <div class="card-row">
                    <div class="card-field">
                        <label for="cardName">Name on Card</label>
                        <input type="text" id="cardName" placeholder="John Smith" required>
                    </div>
                </div>
                
                <div class="card-row">
                    <div class="card-field">
                        <label>Card Details</label>
                        <div id="card-element">
                            <!-- Stripe Elements will create form elements here -->
                        </div>
                        <div id="card-errors" role="alert"></div>
                    </div>
                </div>
                
                <div class="card-row">
                    <div class="card-field">
                        <label for="billingStreet">Billing Address</label>
                        <input type="text" id="billingStreet" placeholder="123 Main St" required>
                    </div>
                </div>
                
                <div class="card-row">
                    <div class="card-field card-field-half">
                        <label for="billingCity">City</label>
                        <input type="text" id="billingCity" placeholder="New York" required>
                    </div>
                    <div class="card-field card-field-quarter">
                        <label for="billingState">State</label>
                        <input type="text" id="billingState" placeholder="NY" maxlength="2" required>
                    </div>
                    <div class="card-field card-field-quarter">
                        <label for="billingZip">ZIP Code</label>
                        <input type="text" id="billingZip" placeholder="10001" maxlength="5" required>
                    </div>
                </div>
            </div>
            
            <button id="payButton" class="pay-button">
                Select Payment Method
            </button>
            
            <div id="paymentSuccess" class="payment-success" style="display: none;">
                <h3>🎉 Booking Confirmed!</h3>
                <p>Your cleaning service has been booked successfully. You will receive a confirmation email shortly.</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Maid For Heaven NYC</h3>
                    <p>Professional cleaning services you can trust. We bring heaven to your home with our meticulous attention to detail and eco-friendly approach.</p>
                </div>
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <p>📞 (347) 759-2000</p>
                    <p>📧 orhans@maidforheavennyc.com</p>
                </div>
                <div class="footer-section">
                    <h3>Service Areas</h3>
                    <p>Manhattan • Brooklyn • Queens<br>Bronx • Staten Island</p>
                </div>
            </div>
        </div>
    </footer>
    <!-- JavaScript -->
    <script src="js/calendar-integration.js"></script>
    <script src="booking-api.js"></script>
    <script>
        // Booking system variables
        let selectedService = null;
        let selectedServicePrice = 0;
        let totalPrice = 0;
        let estimatedHours = 0;
        window.totalPrice = 0;

        // Wait for DOM to be ready before attaching event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 DOM ready - initializing service selection...');
            
            // Service selection - FIXED to prevent double-click bug
            document.querySelectorAll('.service-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    console.log('🎯 Service clicked:', this.dataset.service);
                    
                    // Remove selected class from all options
                    document.querySelectorAll('.service-option').forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Store selected service data
                    selectedService = this.dataset.service;
                    selectedServicePrice = parseInt(this.dataset.price);
                    
                    console.log('✅ Service selected:', selectedService, 'Price:', selectedServicePrice);
                    
                    // Show/hide frequency field based on service type
                    const frequencyGroup = document.getElementById('frequency-group');
                    const frequencySelect = document.getElementById('frequency');
                    if (selectedService === 'moveout' || selectedService === 'movein') {
                        // Hide frequency for Move-Out and Move-In services
                        frequencyGroup.style.display = 'none';
                        frequencySelect.removeAttribute('required');
                        frequencySelect.value = 'one-time'; // Set default value
                    } else {
                        // Show frequency for Standard and Deep cleaning
                        frequencyGroup.style.display = 'block';
                        frequencySelect.setAttribute('required', 'required');
                    }
                    
                    // Update quote display
                    updateQuote();
                    checkFormCompletion();
                });
            });
            
            console.log('✅ Service selection initialized');
        });

        // Form field change listeners
        document.getElementById('bedrooms').addEventListener('change', function() {
            updateQuote();
            checkFormCompletion();
        });

        document.getElementById('bathrooms').addEventListener('change', function() {
            updateQuote();
            checkFormCompletion();
        });

        document.getElementById('preferredDate').addEventListener('change', function() {
            checkCalendarConflicts();
            checkFormCompletion();
        });

        document.getElementById('preferredTime').addEventListener('change', function() {
            checkCalendarConflicts();
            checkFormCompletion();
        });

        document.getElementById('frequency').addEventListener('change', function() {
            updateQuote();
            checkFormCompletion();
        });

        // Other form fields
        ['address', 'name', 'email', 'phone'].forEach(fieldId => {
            const element = document.getElementById(fieldId);
            if (element) {
                element.addEventListener('input', checkFormCompletion);
            }
        });

        function updateQuote() {
            const bedrooms = document.getElementById('bedrooms').value;
            const bathrooms = document.getElementById('bathrooms').value;
            
            // Always update service name if service is selected
            if (selectedService) {
                const serviceElement = document.getElementById('quoteService');
                if (serviceElement) {
                    serviceElement.textContent = getServiceName(selectedService);
                }
                
                const rateElement = document.getElementById('quoteRate');
                if (rateElement) {
                    if (selectedService === 'deep') {
                        rateElement.textContent = 'Flat Rate';
                    } else {
                        rateElement.textContent = '$' + selectedServicePrice + '/hr';
                    }
                }
            }
            
            if (!selectedService || !bedrooms || !bathrooms) {
                return;
            }
            
            // Calculate estimated hours based on property size
            estimatedHours = calculateEstimatedHours(bedrooms, bathrooms, selectedService);
            
            // Calculate total price - different logic for different services
            if (selectedService === 'deep') {
                // Deep cleaning uses flat rates from chart
                totalPrice = calculateDeepCleaningPrice(bedrooms, parseFloat(bathrooms));
            } else if (selectedService === 'moveout') {
                // Move-out cleaning uses flat rates
                totalPrice = calculateMoveOutPrice(bedrooms, parseFloat(bathrooms));
            } else if (selectedService === 'movein') {
                // Move-in cleaning uses flat rates (same as move-out for now)
                totalPrice = calculateMoveOutPrice(bedrooms, parseFloat(bathrooms));
            } else {
                // Standard cleaning uses hourly rates
                totalPrice = selectedServicePrice * estimatedHours;
            }
            
            // Apply frequency discount only for standard cleaning
            const frequencyValue = document.getElementById('frequency')?.value;
            if (frequencyValue && selectedService === 'standard') {
                const discount = getFrequencyDiscount(frequencyValue);
                totalPrice = totalPrice * (1 - discount);
            }
            
            window.totalPrice = totalPrice;
            
            // Update display with error checking
            const sizeElement = document.getElementById('quoteSize');
            if (sizeElement) {
                sizeElement.textContent = getPropertySize(bedrooms, bathrooms);
            }
            
            const timeElement = document.getElementById('quoteTime');
            if (timeElement) {
                timeElement.textContent = estimatedHours + ' hours';
            }
            
            // Update frequency display (hide for Move-Out and Move-In)
            const frequencyElement = document.getElementById('quoteFrequency');
            if (frequencyElement) {
                if (selectedService === 'moveout' || selectedService === 'movein') {
                    // Hide frequency row for Move-Out and Move-In services
                    const frequencyRow = frequencyElement.closest('tr') || frequencyElement.parentElement;
                    if (frequencyRow) {
                        frequencyRow.style.display = 'none';
                    }
                } else {
                    // Show frequency row for other services
                    const frequencyRow = frequencyElement.closest('tr') || frequencyElement.parentElement;
                    if (frequencyRow) {
                        frequencyRow.style.display = '';
                    }
                    
                    if (frequencyValue) {
                        const frequencyText = getFrequencyDisplayText(frequencyValue);
                        frequencyElement.textContent = frequencyText;
                    } else {
                        frequencyElement.textContent = 'Select frequency';
                    }
                }
            }
            
            const rateElement = document.getElementById('quoteRate');
            if (rateElement) {
                if (selectedService === 'deep' || selectedService === 'moveout' || selectedService === 'movein') {
                    rateElement.textContent = 'Flat Rate';
                } else {
                    rateElement.textContent = '$' + selectedServicePrice + '/hr';
                }
            }
            
            const totalElement = document.getElementById('quoteTotal');
            if (totalElement) {
                totalElement.textContent = '$' + totalPrice.toFixed(2);
            }
            
            console.log('✅ Quote updated:', {
                service: selectedService,
                bedrooms: bedrooms,
                bathrooms: bathrooms,
                hours: estimatedHours,
                rate: selectedServicePrice,
                total: totalPrice
            });
        }

        function calculateEstimatedHours(bedrooms, bathrooms, service) {
            const bathroomCount = parseFloat(bathrooms);
            
            if (service === 'deep') {
                // Deep cleaning uses flat rate chart
                return calculateDeepCleaningHours(bedrooms, bathroomCount);
            } else if (service === 'standard') {
                // Standard cleaning: 1 bed 1 bath = 3 hours minimum
                // Add 45 minutes (0.75 hours) per additional bedroom
                // Add 1 hour per additional bathroom
                let hours = 3; // Base for 1 bed 1 bath
                
                // Calculate additional bedrooms
                let bedroomCount = 1;
                switch(bedrooms) {
                    case 'studio': bedroomCount = 0.5; hours = 2.5; break; // Studio is less than 1 bedroom
                    case '1br': bedroomCount = 1; break;
                    case '2br': bedroomCount = 2; break;
                    case '3br': bedroomCount = 3; break;
                    case '4br': bedroomCount = 4; break;
                    case '5br': bedroomCount = 5; break;
                }
                
                if (bedroomCount > 1) {
                    hours += (bedroomCount - 1) * 0.75; // 45 minutes per additional bedroom
                }
                
                if (bathroomCount > 1) {
                    hours += (bathroomCount - 1) * 1; // 1 hour per additional bathroom
                }
                
                return Math.ceil(hours * 4) / 4; // Round to nearest 0.25
            } else if (service === 'moveout') {
                // Move-out cleaning: use standard calculation * 1.5
                let standardHours = calculateEstimatedHours(bedrooms, bathrooms, 'standard');
                return Math.ceil(standardHours * 1.5 * 4) / 4;
            } else if (service === 'movein') {
                // Move-in cleaning: use standard calculation * 1.5 (same as move-out)
                let standardHours = calculateEstimatedHours(bedrooms, bathrooms, 'standard');
                return Math.ceil(standardHours * 1.5 * 4) / 4;
            }
            
            return 3; // Default fallback
        }
        
        function calculateDeepCleaningHours(bedrooms, bathroomCount) {
            // Deep cleaning flat rate chart
            if (bedrooms === 'studio' && bathroomCount === 1) {
                return 4; // Studio / 1 Bath: 4 hrs
            } else if (bedrooms === '1br' && bathroomCount === 1) {
                return 6; // 1 Bed / 1 Bath: 6 hrs
            } else if (bedrooms === '2br' && bathroomCount === 1) {
                return 7; // 2 Bed / 1 Bath: 7 hrs
            } else if (bedrooms === '2br' && bathroomCount === 2) {
                return 8; // 2 Bed / 2 Bath: 8 hrs
            } else if (bedrooms === '3br' && bathroomCount === 2) {
                return 9; // 3 Bed / 2 Bath: 9 hrs
            } else if (bedrooms === '3br' && bathroomCount >= 3) {
                return 10; // 3 Bed / 3 Bath: 10 hrs
            } else if (bedrooms === '4br') {
                return 11; // 4 Bed / 2-3 Bath: 11 hrs
            } else if (bedrooms === '5br') {
                return 13; // 5 Bed+ / Large Homes: 12-14+ hrs (using 13 as average)
            }
            
            // Default calculation for edge cases
            return 8;
        }
        
        function calculateDeepCleaningPrice(bedrooms, bathroomCount) {
            // Deep cleaning flat rate chart
            if (bedrooms === 'studio' && bathroomCount === 1) {
                return 230; // Studio / 1 Bath: $230
            } else if (bedrooms === '1br' && bathroomCount === 1) {
                return 320; // 1 Bed / 1 Bath: $320
            } else if (bedrooms === '2br' && bathroomCount === 1) {
                return 365; // 2 Bed / 1 Bath: $365
            } else if (bedrooms === '2br' && bathroomCount === 2) {
                return 415; // 2 Bed / 2 Bath: $415
            } else if (bedrooms === '3br' && bathroomCount === 2) {
                return 475; // 3 Bed / 2 Bath: $475
            } else if (bedrooms === '3br' && bathroomCount >= 3) {
                return 530; // 3 Bed / 3 Bath: $530
            } else if (bedrooms === '4br') {
                return 590; // 4 Bed / 2-3 Bath: $590
            } else if (bedrooms === '5br') {
                return 725; // 5 Bed+ / Large Homes: $650-800+ (using $725 as average)
            }
            
            // Default calculation for edge cases
            return 400;
        }

        function calculateMoveOutPrice(bedrooms, bathroomCount) {
            // Move-out cleaning flat rate chart
            if (bedrooms === 'studio' && bathroomCount === 1) {
                return 220; // Studio / 1 Bath: $220
            } else if (bedrooms === '1br' && bathroomCount === 1) {
                return 275; // 1 Bed / 1 Bath: $275
            } else if (bedrooms === '1br' && bathroomCount >= 1.5) {
                return 295; // 1 Bed / 1.5+ Bath: $295 (add $20 per extra half bath)
            } else if (bedrooms === '2br' && bathroomCount === 1) {
                return 320; // 2 Bed / 1 Bath: $320
            } else if (bedrooms === '2br' && bathroomCount >= 1.5) {
                return 350; // 2 Bed / 1.5+ Bath: $350 (add $30 per extra half bath)
            } else if (bedrooms === '3br' && bathroomCount === 1) {
                return 380; // 3 Bed / 1 Bath: $380
            } else if (bedrooms === '3br' && bathroomCount >= 1.5) {
                return 420; // 3 Bed / 1.5+ Bath: $420 (add $40 per extra half bath)
            } else if (bedrooms === '4br' && bathroomCount === 1) {
                return 420; // 4 Bed / 1 Bath: $420
            } else if (bedrooms === '4br' && bathroomCount >= 1.5) {
                return 470; // 4 Bed / 1.5+ Bath: $470 (add $50 per extra half bath)
            } else if (bedrooms === '5br' && bathroomCount === 1) {
                return 480; // 5 Bed / 1 Bath: $480
            } else if (bedrooms === '5br' && bathroomCount >= 1.5) {
                return 540; // 5 Bed / 1.5+ Bath: $540 (add $60 per extra half bath)
            }
            
            // Default calculation for edge cases
            return 350;
        }

        function getServiceName(service) {
            switch(service) {
                case 'standard': return 'Standard Cleaning';
                case 'deep': return 'Deep Cleaning';
                case 'moveout': return 'Move-Out Cleaning';
                case 'movein': return 'Move-In Cleaning';
                default: return 'Select service';
            }
        }

        function getPropertySize(bedrooms, bathrooms) {
            const bedroomText = bedrooms.replace('br', ' BR').replace('studio', 'Studio');
            const cleanerInfo = getCleanerInfo(bedrooms, parseFloat(bathrooms));
            return bedroomText + ', ' + bathrooms + ' Bath' + cleanerInfo;
        }
        
        function getFrequencyDisplayText(frequency) {
            switch(frequency) {
                case 'one-time': return 'One-time cleaning';
                case 'weekly': return 'Weekly';
                case 'bi-weekly': return 'Bi-weekly (every 2 weeks)';
                case 'monthly': return 'Monthly';
                case 'custom': return 'Custom schedule';
                default: return 'Select frequency';
            }
        }
        
        function getFrequencyDiscount(frequency) {
            switch(frequency) {
                case 'one-time': return 0.15; // 15% off
                case 'monthly': return 0.15;  // 15% off
                case 'bi-weekly': return 0.25; // 25% off
                case 'weekly': return 0.30;    // 30% off
                case 'custom': return 0.15;    // 15% off (treat as one-time)
                default: return 0; // No discount
            }
        }
        
        function getCleanerInfo(bedrooms, bathroomCount) {
            // 2 cleaners for anything over 1 bed 1 bath
            if (bedrooms === 'studio' || (bedrooms === '1br' && bathroomCount === 1)) {
                return ' (1 cleaner)';
            } else {
                return ' (2 cleaners)';
            }
        }

        function checkFormCompletion() {
            const bookNowBtn = document.getElementById('bookNowBtn');
            if (!bookNowBtn) return;
            
            // Simple validation - check if all required fields have values
            const requiredFields = [
                { element: selectedService, name: 'Service' },
                { element: document.getElementById('bedrooms')?.value, name: 'Bedrooms' },
                { element: document.getElementById('bathrooms')?.value, name: 'Bathrooms' },
                { element: document.getElementById('preferredDate')?.value, name: 'Date' },
                { element: document.getElementById('preferredTime')?.value, name: 'Time' },
                { element: document.getElementById('frequency')?.value, name: 'Frequency' },
                { element: document.getElementById('address')?.value?.trim(), name: 'Address' },
                { element: document.getElementById('name')?.value?.trim(), name: 'Name' },
                { element: document.getElementById('email')?.value?.trim(), name: 'Email' },
                { element: document.getElementById('phone')?.value?.trim(), name: 'Phone' }
            ];
            
            const missingFields = requiredFields.filter(field => !field.element).map(field => field.name);
            
            if (missingFields.length === 0) {
                // All fields completed - enable button
                bookNowBtn.disabled = false;
                bookNowBtn.textContent = 'Book Now & Pay Online';
                bookNowBtn.style.backgroundColor = '#4CAF50';
                bookNowBtn.style.cursor = 'pointer';
                bookNowBtn.style.opacity = '1';
                console.log('✅ All fields completed - button enabled');
            } else {
                // Some fields missing - disable button
                bookNowBtn.disabled = true;
                if (missingFields.length <= 3) {
                    bookNowBtn.textContent = 'Complete: ' + missingFields.join(', ');
                } else {
                    bookNowBtn.textContent = 'Complete Form to Book (' + missingFields.length + ' fields)';
                }
                bookNowBtn.style.backgroundColor = '#cccccc';
                bookNowBtn.style.cursor = 'not-allowed';
                bookNowBtn.style.opacity = '0.6';
                console.log(`Missing fields: ${missingFields.join(', ')}`);
            }
        }

        // Book Now button click
        document.getElementById('bookNowBtn').addEventListener('click', function() {
            if (!this.disabled) {
                openPaymentModal();
            }
        });

        function openPaymentModal() {
            // Populate payment modal with booking details
            document.getElementById('paymentService').textContent = getServiceName(selectedService);
            
            const date = document.getElementById('preferredDate').value;
            const time = document.getElementById('preferredTime').value;
            document.getElementById('paymentDateTime').textContent = formatDateTime(date, time);
            
            document.getElementById('paymentAddress').textContent = document.getElementById('address').value;
            document.getElementById('paymentDuration').textContent = estimatedHours + ' hours';
            document.getElementById('paymentTotal').textContent = '$' + totalPrice.toFixed(2);
            
            // Show modal
            document.getElementById('paymentModal').style.display = 'flex';
            
            // Reset payment method selection
            document.querySelectorAll('input[name="payment"]').forEach(radio => {
                radio.checked = false;
            });
            document.querySelectorAll('.payment-method').forEach(method => {
                method.classList.remove('selected');
            });
            
            updatePayButton();
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').style.display = 'none';
        }

        function formatDateTime(date, time) {
            const dateObj = new Date(date);
            const dateStr = dateObj.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            let timeStr = '';
            switch(time) {
                case 'morning': timeStr = '8:00 AM - 12:00 PM'; break;
                case 'afternoon': timeStr = '12:00 PM - 5:00 PM'; break;
                case 'evening': timeStr = '5:00 PM - 8:00 PM'; break;
            }
            
            return dateStr + ', ' + timeStr;
        }

        // Stripe integration
        let stripe = null;
        let elements = null;
        let cardElement = null;

        // Initialize Stripe
        function initializeStripe() {
            // Your actual Stripe publishable key
            stripe = Stripe('pk_live_51RqIC7CcPlxCeVwQlIuWJDBfGc3OUKA6wWegt0ASVjhROtmOknVaZ3VVLjZJxNGVIXQdO2AXB2wrqXzNBtTag8DC00FAkZ17tb');
            elements = stripe.elements();
            
            // Create card element
            cardElement = elements.create('card', {
                style: {
                    base: {
                        fontSize: '16px',
                        color: '#424770',
                        '::placeholder': {
                            color: '#aab7c4',
                        },
                    },
                },
            });
        }

        // Payment method selection
        document.querySelectorAll('.payment-method').forEach(method => {
            method.addEventListener('click', function() {
                // Remove selected class from all methods
                document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                
                // Add selected class to clicked method
                this.classList.add('selected');
                
                // Check the radio button
                const radio = this.querySelector('input[type="radio"]');
                radio.checked = true;
                
                // Show/hide credit card form based on selection
                const creditCardForm = document.getElementById('creditCardForm');
                if (radio.value === 'card') {
                    creditCardForm.style.display = 'block';
                    
                    // Initialize Stripe if not already done
                    if (!stripe) {
                        initializeStripe();
                    }
                    
                    // Mount card element if not already mounted
                    if (cardElement && !cardElement._mounted) {
                        cardElement.mount('#card-element');
                        cardElement._mounted = true;
                        
                        // Handle real-time validation errors from the card Element
                        cardElement.on('change', function(event) {
                            const displayError = document.getElementById('card-errors');
                            if (event.error) {
                                displayError.textContent = event.error.message;
                            } else {
                                displayError.textContent = '';
                            }
                        });
                    }
                    
                    // Auto-fill name from booking form
                    const customerName = document.getElementById('name').value;
                    if (customerName) {
                        document.getElementById('cardName').value = customerName;
                    }
                    
                    // Auto-fill billing address from service address
                    const serviceAddress = document.getElementById('address').value;
                    if (serviceAddress) {
                        // Parse the address to fill separate fields
                        const addressParts = parseAddress(serviceAddress);
                        document.getElementById('billingStreet').value = addressParts.street || '';
                        document.getElementById('billingCity').value = addressParts.city || '';
                        document.getElementById('billingState').value = addressParts.state || '';
                        document.getElementById('billingZip').value = addressParts.zip || '';
                    }
                } else {
                    creditCardForm.style.display = 'none';
                }
                
                updatePayButton();
            });
        });

        function updatePayButton() {
            const payButton = document.getElementById('payButton');
            const selectedPayment = document.querySelector('input[name="payment"]:checked');
            
            if (selectedPayment) {
                const method = selectedPayment.value;
                if (method === 'later') {
                    payButton.textContent = 'Book Now and Pay Later';
                } else {
                    payButton.textContent = 'Pay $' + totalPrice.toFixed(2) + ' Now';
                }
                payButton.disabled = false;
            } else {
                payButton.textContent = 'Select Payment Method';
                payButton.disabled = true;
            }
        }

        function simulatePayment() {
            console.log('🎉 Payment function called!');
            
            const selectedPayment = document.querySelector('input[name="payment"]:checked');
            if (!selectedPayment) return;
            
            const paymentMethod = selectedPayment.value;
            
            // Handle credit card payment with Stripe
            if (paymentMethod === 'card') {
                handleStripePayment();
                return;
            }
            
            // Handle other payment methods (PayPal, Venmo/Zelle)
            handleOtherPayments(paymentMethod);
        }
        
        async function handleStripePayment() {
            if (!stripe || !cardElement) {
                alert('Payment system not initialized. Please refresh the page and try again.');
                return;
            }
            
            const payButton = document.getElementById('payButton');
            payButton.disabled = true;
            payButton.textContent = 'Processing Payment...';
            
            try {
                // Get card holder name and billing address from separate fields
                const cardName = document.getElementById('cardName').value;
                const billingStreet = document.getElementById('billingStreet').value;
                const billingCity = document.getElementById('billingCity').value;
                const billingState = document.getElementById('billingState').value;
                const billingZip = document.getElementById('billingZip').value;
                
                if (!cardName || !billingStreet || !billingCity || !billingState || !billingZip) {
                    throw new Error('Please fill in all credit card and billing address fields');
                }
                
                // Create payment method
                const {error, paymentMethod} = await stripe.createPaymentMethod({
                    type: 'card',
                    card: cardElement,
                    billing_details: {
                        name: cardName,
                        address: {
                            line1: billingStreet,
                            city: billingCity,
                            state: billingState,
                            postal_code: billingZip,
                            country: 'US',
                        },
                    },
                });
                
                if (error) {
                    throw error;
                }
                
                // Get booking data for payment processing
                const bookingData = getBookingData();
                const bookingId = '#MFH' + Date.now();
                
                // Process real payment through backend API
                const paymentResponse = await fetch('https://kkh7ikcyg7ze.manus.space/api/process-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        payment_method_id: paymentMethod.id,
                        amount: totalPrice,
                        currency: 'usd',
                        booking_data: {
                            ...bookingData,
                            booking_id: bookingId
                        }
                    })
                });
                
                const paymentResult = await paymentResponse.json();
                
                if (!paymentResult.success) {
                    throw new Error(paymentResult.error || 'Payment processing failed');
                }
                
                // Payment successful - send confirmations
                console.log('✅ Payment processed successfully:', paymentResult);
                
                // Send confirmation email
                sendConfirmationEmail(bookingData, bookingId, 'Credit Card');
                
                // Send SMS confirmation
                sendSMSConfirmation(bookingData, bookingId, 'Credit Card');
                
                // Show success message
                alert('🎉 Payment Successful!\n\n' +
                      'Booking ID: ' + bookingId + '\n' +
                      'Payment ID: ' + paymentResult.payment_intent_id + '\n' +
                      'Amount Charged: $' + paymentResult.amount_received + '\n\n' +
                      'Service: ' + getServiceName(selectedService) + '\n' +
                      'Date: ' + formatDateTime(bookingData.date, bookingData.time) + '\n' +
                      'Total: $' + totalPrice.toFixed(2) + '\n' +
                      'Payment Method: Credit Card\n\n' +
                      'Confirmation email & SMS sent to:\n' +
                      '📧 ' + bookingData.email + '\n' +
                      '📱 ' + bookingData.phone + '\n\n' +
                      'Thank you for choosing Maid For Heaven NYC!');
                
                // Send booking to backend
                if (window.bookingAPI) {
                    window.bookingAPI.submitBooking({...bookingData, paymentMethod: 'credit_card', bookingId: bookingId});
                }
                
                closePaymentModal();
                
                // Redirect to homepage after 2 seconds
                setTimeout(() => {
                    window.location.href = '/';
                }, 2000);           
            } catch (error) {
                console.error('Payment error:', error);
                alert('Payment failed: ' + error.message);
                payButton.disabled = false;
                payButton.textContent = 'Pay $' + totalPrice.toFixed(2) + ' Now';
            }
        }
        
        function handleOtherPayments(paymentMethod) {
            console.log('🎯 Processing payment method:', paymentMethod);
            
            // Get booking details
            const bookingData = getBookingData();
            
            // Generate booking ID
            const bookingId = '#MFH' + Date.now();
            
            let paymentText = '';
            if (paymentMethod === 'paypal') {
                paymentText = 'PayPal';
            } else if (paymentMethod === 'later') {
                paymentText = 'Pay on service day (Venmo/Zelle)';
            }
            
            // Send confirmation email
            sendConfirmationEmail(bookingData, bookingId, paymentText);
            
            // Send SMS confirmation
            sendSMSConfirmation(bookingData, bookingId, paymentText);
            
            // Show success message
            alert('🎉 Booking Confirmed!\n\n' +
                  'Booking ID: ' + bookingId + '\n\n' +
                  'Service: ' + getServiceName(selectedService) + '\n' +
                  'Date: ' + formatDateTime(bookingData.date, bookingData.time) + '\n' +
                  'Total: $' + totalPrice.toFixed(2) + '\n' +
                  'Payment Method: ' + paymentText + '\n\n' +
                  'Confirmation email & SMS sent to:\n' +
                  '📧 ' + bookingData.email + '\n' +
                  '📱 ' + bookingData.phone + '\n\n' +
                  'Thank you for choosing Maid For Heaven NYC!');
            
            // Send booking to backend
            if (window.bookingAPI) {
                window.bookingAPI.submitBooking({...bookingData, paymentMethod: paymentMethod, bookingId: bookingId});
            }
            
            console.log('✅ Booking completed successfully');
            closePaymentModal();
            
            // Redirect to homepage after 3 seconds
            setTimeout(() => {
                window.location.href = '/';
            }, 3000);
        }
        
        // Email confirmation system
        function sendConfirmationEmail(bookingData, bookingId, paymentMethod) {
            console.log('📧 Sending confirmation email...');
            
            const emailData = {
                customerName: bookingData.name,
                bookingId: bookingId,
                service: getServiceName(selectedService),
                date: formatDateTime(bookingData.date, bookingData.time),
                address: bookingData.address,
                phone: bookingData.phone,
                estimatedHours: estimatedHours,
                totalPrice: totalPrice,
                paymentMethod: paymentMethod,
                instructions: bookingData.instructions || 'None',
                email: bookingData.email
            };
            
            // Send email via EmailJS
            if (typeof emailjs !== 'undefined') {
                emailjs.send('service_to99nwh', 'template_631z0ql', emailData)
                    .then(function(response) {
                        console.log('✅ Email sent successfully:', response);
                    })
                    .catch(function(error) {
                        console.error('❌ Email sending failed:', error);
                        // Still continue with booking even if email fails
                    });
            } else {
                console.error('❌ EmailJS not loaded');
            }
        }
        
        // Parse address string into components
        function parseAddress(addressString) {
            // Simple address parsing - handles common formats
            const parts = addressString.split(',').map(part => part.trim());
            
            let street = '';
            let city = '';
            let state = '';
            let zip = '';
            
            if (parts.length >= 1) {
                street = parts[0];
            }
            
            if (parts.length >= 2) {
                city = parts[1];
            }
            
            if (parts.length >= 3) {
                // Last part might contain state and zip
                const lastPart = parts[parts.length - 1];
                const stateZipMatch = lastPart.match(/([A-Z]{2})\s*(\d{5})/);
                
                if (stateZipMatch) {
                    state = stateZipMatch[1];
                    zip = stateZipMatch[2];
                } else {
                    // Try to extract just state if no zip found
                    const stateMatch = lastPart.match(/([A-Z]{2})/);
                    if (stateMatch) {
                        state = stateMatch[1];
                    }
                }
            }
            
            return { street, city, state, zip };
        }

        // SMS confirmation system
        function sendSMSConfirmation(bookingData, bookingId, paymentMethod) {
            console.log('📱 Sending SMS confirmation...');
            
            const smsMessage = `🎉 Booking Confirmed - Maid For Heaven NYC
            
Booking ID: ${bookingId}
Service: ${getServiceName(selectedService)}
Date: ${formatDateTime(bookingData.date, bookingData.time)}
Address: ${bookingData.address}
Total: $${totalPrice.toFixed(2)}
Payment: ${paymentMethod}

We'll call you 24hrs before to confirm.
Questions? Call (347) 759-2000

Thank you for choosing us! ✨`;

            const smsData = {
                to: bookingData.phone,
                message: smsMessage,
                customerName: bookingData.name,
                bookingId: bookingId
            };
            
            // Send SMS via backend API (Twilio)
            fetch('https://zmhqivcmgm9o.manus.space/api/send-sms', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(smsData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('✅ SMS sent successfully:', data);
            })
            .catch(error => {
                console.error('❌ SMS sending failed:', error);
                // Continue with booking even if SMS fails
            });
        }
        
        function getBookingData() {
            return {
                service: selectedService,
                bedrooms: document.getElementById('bedrooms').value,
                bathrooms: document.getElementById('bathrooms').value,
                date: document.getElementById('preferredDate').value,
                time: document.getElementById('preferredTime').value,
                frequency: document.getElementById('frequency').value,
                address: document.getElementById('address').value,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                instructions: document.getElementById('instructions').value,
                totalPrice: totalPrice,
                estimatedHours: estimatedHours
            };
        }

        // Initialize booking system
        function initializeBookingSystem() {
            console.log('Initializing booking system...');
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('preferredDate').setAttribute('min', today);
            
            // Initialize calendar integration if available
            if (typeof initializeCalendar === 'function') {
                initializeCalendar();
            }
            
            console.log('✅ Booking system initialized');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeBookingSystem);

        // Close modal when clicking outside
        document.getElementById('paymentModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePaymentModal();
            }
        });
        
        // FIX BOOKING BUTTON - Enable and add click handler
        function fixBookingButton() {
            const buttons = document.querySelectorAll('button');
            let bookingButton = null;
            buttons.forEach(btn => {
                if (btn.textContent.includes('Complete Form') || btn.textContent.includes('Book Now')) {
                    bookingButton = btn;
                }
            });

            if (bookingButton && !bookingButton.dataset.fixed) {
                // Enable the button
                bookingButton.disabled = false;
                
                // Add click handler
                bookingButton.onclick = function(e) {
                    e.preventDefault();
                    console.log('🎉 Booking button clicked!');
                    
                    // Check if service is selected
                    const service = document.querySelector('.service-option.selected');
                    if (!service) {
                        alert('⚠️ Please select a service type first.');
                        return;
                    }
                    
                    // Open payment modal
                    const modal = document.getElementById('paymentModal');
                    if (modal) {
                        modal.style.display = 'flex';
                        console.log('✅ Payment modal opened!');
                        
                        // Update modal with booking details
                        updatePaymentModal();
                    } else {
                        // If no modal, just show confirmation
                        alert('🎉 Booking Confirmed!\n\nBooking ID: #MFH' + Date.now() + '\n\nWe will contact you within 24 hours to confirm details.\n\nThank you for choosing Maid For Heaven NYC!');
                        setTimeout(() => location.reload(), 2000);
                    }
                };
                
                // Style the button to show it's active
                bookingButton.style.cssText = 'background: #28a745 !important; color: white !important; cursor: pointer !important; opacity: 1 !important;';
                bookingButton.dataset.fixed = 'true';
                
                console.log('✅ Booking button fixed and enabled!');
            }
        }
        
        // Fix pay button in modal
        function fixPayButton() {
            const payButton = document.getElementById('payButton');
            if (payButton && !payButton.dataset.fixed) {
                payButton.onclick = function(e) {
                    e.preventDefault();
                    console.log('💳 Pay button clicked!');
                    simulatePayment();
                };
                payButton.dataset.fixed = 'true';
                console.log('✅ Pay button fixed!');
            }
        }
        
        // Update payment modal with booking details
        function updatePaymentModal() {
            // Update service
            const serviceElement = document.getElementById('paymentService');
            if (serviceElement) {
                serviceElement.textContent = getServiceName(selectedService);
            }
            
            // Update date & time
            const dateTimeElement = document.getElementById('paymentDateTime');
            if (dateTimeElement) {
                const date = document.getElementById('preferredDate').value;
                const time = document.getElementById('preferredTime').value;
                dateTimeElement.textContent = formatDateTime(date, time);
            }
            
            // Update address
            const addressElement = document.getElementById('paymentAddress');
            if (addressElement) {
                addressElement.textContent = document.getElementById('address').value;
            }
            
            // Update duration
            const durationElement = document.getElementById('paymentDuration');
            if (durationElement) {
                durationElement.textContent = estimatedHours + ' hours';
            }
            
            // Update total
            const totalElement = document.getElementById('paymentTotal');
            if (totalElement) {
                totalElement.textContent = '$' + totalPrice.toFixed(2);
            }
            
            // Fix pay button
            setTimeout(fixPayButton, 100);
        }
        
        // Run the fixes
        document.addEventListener('DOMContentLoaded', function() {
            fixBookingButton();
            fixPayButton();
        });
        window.addEventListener('load', function() {
            fixBookingButton();
            fixPayButton();
        });
        setTimeout(function() {
            fixBookingButton();
            fixPayButton();
        }, 1000);
    </script>

</body>
</html>

/* Force Vercel deployment - Sat Aug  2 19:25:57 EDT 2025 */
