<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Now - Instant Quote & Payment | Maid For Heaven NYC</title>
    <!-- Navigation links updated - cache bust v2.0 -->
    <link rel="stylesheet" href="css/styles.css?v=20250716mobile004">
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        /* Booking Page Specific Styles */
        .booking-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }
        
        .booking-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .booking-header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .booking-header h1 {
            margin: 0 0 8px 0;
            font-size: 1.6rem;
        }
        
        .booking-header p {
            font-size: 0.95rem;
            margin: 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }
        
        .service-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .service-option {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
        }
        
        .service-option:hover {
            border-color: #4CAF50;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.2);
        }
        
        .service-option.selected {
            border-color: #4CAF50;
            background: #f8fff8;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .service-icon {
            font-size: 1.6rem;
            background: #4CAF50;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .service-info {
            flex: 1;
        }
        
        .service-info h3 {
            margin: 0 0 4px 0;
            color: #333;
            font-size: 1.1rem;
        }
        
        .service-info p {
            margin: 0;
            color: #666;
            font-size: 0.85rem;
        }
        
        .service-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4CAF50;
        }
        
        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .quote-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
        }
        
        .quote-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .quote-header h2 {
            margin: 0 0 6px 0;
            font-size: 1.4rem;
        }
        
        .quote-header p {
            font-size: 0.9rem;
            margin: 0;
        }
        
        .quote-display {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 16px;
        }
        
        .quote-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .quote-total {
            border-top: 2px solid #4CAF50;
            padding-top: 12px;
            margin-top: 12px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .quote-details {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e0e0e0;
            color: #666;
            font-size: 0.85rem;
        }
        
        .book-now-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .book-now-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .book-now-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Payment Modal Styles */
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .payment-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .close-modal {
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }
        
        .payment-booking-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .summary-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .total-line {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .payment-methods {
            margin-bottom: 25px;
        }
        
        .payment-method {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }
        
        .payment-method.selected {
            border-color: #4CAF50;
            background: #f8fff8;
        }
        
        .pay-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .payment-success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        /* Stripe Payment Styles */
        .card-input-container {
            margin: 20px 0;
        }
        
        .card-input-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        #card-element {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            transition: border-color 0.3s ease;
        }
        
        #card-element:focus-within {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        #card-errors {
            color: #e53e3e;
            font-size: 14px;
            margin-top: 8px;
            min-height: 20px;
        }
        
        .stripe-pay-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .stripe-pay-button:hover:not(:disabled) {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .stripe-pay-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .payment-form-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .payment-form-header h3 {
            margin: 0 0 8px 0;
            color: #333;
        }
        
        .payment-form-header p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }
        
        .payment-security {
            text-align: center;
            margin-top: 15px;
        }
        
        .payment-security p {
            font-size: 0.85rem;
            color: #666;
            margin: 0;
        }
        
        .payment-errors {
            background: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border: 1px solid #fcc;
        }
        
        @media (max-width: 768px) {
            .booking-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .quote-section {
                position: static;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="nav-brand">
                    <a href="index.html">Maid For Heaven NYC</a>
                </div>
                <nav class="nav-menu">
                    <a href="index.html">HOME</a>
                    <a href="index.html#services">SERVICES</a>
                    <a href="index.html#about">ABOUT</a>
                    <a href="faq.html">FAQ</a>
                    <a href="contact-us.html">CONTACT</a>
                </nav>
                <div class="nav-contact">
                    <a href="tel:+13477592000" class="phone-link">(347) 759-2000</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="booking-container">
            <!-- Left Column - Booking Form -->
            <div class="booking-form">
                <div class="booking-header">
                    <h1>📅 Book Your Cleaning Service</h1>
                    <p>Get instant pricing with secure online payment. Professional cleaning team.</p>
                </div>

                <!-- Service Type -->
                <div class="form-group">
                    <label>Service Type</label>
                    <div class="service-options">
                        <div class="service-option" data-service="standard" data-price="25">
                            <div class="service-icon">🏠</div>
                            <div class="service-info">
                                <h3>Standard Cleaning</h3>
                                <p>Regular maintenance cleaning for your home</p>
                            </div>
                            <div class="service-price">$25/hr</div>
                        </div>
                        <div class="service-option" data-service="deep" data-price="35">
                            <div class="service-icon">✨</div>
                            <div class="service-info">
                                <h3>Deep Cleaning</h3>
                                <p>Thorough cleaning including baseboards, inside appliances</p>
                            </div>
                            <div class="service-price">$35/hr</div>
                        </div>
                        <div class="service-option" data-service="moveout" data-price="40">
                            <div class="service-icon">📦</div>
                            <div class="service-info">
                                <h3>Move-Out Cleaning</h3>
                                <p>Complete cleaning for moving out or post-construction</p>
                            </div>
                            <div class="service-price">$40/hr</div>
                        </div>
                    </div>
                </div>

                <!-- Property Details -->
                <div class="form-group">
                    <label for="bedrooms">Bedrooms</label>
                    <select id="bedrooms" required>
                        <option value="">Select bedrooms</option>
                        <option value="studio">Studio</option>
                        <option value="1br">1 Bedroom</option>
                        <option value="2br">2 Bedrooms</option>
                        <option value="3br">3 Bedrooms</option>
                        <option value="4br">4 Bedrooms</option>
                        <option value="5br">5+ Bedrooms</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bathrooms">Bathrooms</label>
                    <select id="bathrooms" required>
                        <option value="">Select bathrooms</option>
                        <option value="1">1 Bathroom</option>
                        <option value="1.5">1.5 Bathrooms</option>
                        <option value="2">2 Bathrooms</option>
                        <option value="2.5">2.5 Bathrooms</option>
                        <option value="3">3 Bathrooms</option>
                        <option value="3.5">3.5 Bathrooms</option>
                        <option value="4">4+ Bathrooms</option>
                    </select>
                </div>

                <!-- Date and Time -->
                <div class="form-group">
                    <label for="date">Preferred Date</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group">
                    <label for="time">Preferred Time</label>
                    <select id="time" required>
                        <option value="">Select time</option>
                        <option value="morning">Morning (8:00 AM - 12:00 PM)</option>
                        <option value="afternoon">Afternoon (12:00 PM - 5:00 PM)</option>
                        <option value="evening">Evening (5:00 PM - 8:00 PM)</option>
                    </select>
                </div>

                <!-- Address -->
                <div class="form-group">
                    <label for="address">Service Address</label>
                    <input type="text" id="address" placeholder="Enter your full address" required>
                </div>

                <!-- Contact Information -->
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" placeholder="Enter your full name" required>
                </div>

                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" placeholder="Enter your phone number" required>
                </div>

                <!-- Special Instructions -->
                <div class="form-group">
                    <label for="instructions">Special Instructions (Optional)</label>
                    <textarea id="instructions" rows="3" placeholder="Any special requests or areas of focus?"></textarea>
                </div>
            </div>

            <!-- Right Column - Quote and Booking -->
            <div class="quote-section">
                <div class="quote-header">
                    <h2>💰 Instant Quote</h2>
                    <p>Professional cleaning with 100% satisfaction guarantee</p>
                </div>

                <div class="quote-display">
                    <div class="quote-line">
                        <span>Service Type:</span>
                        <span id="quoteService">Select service</span>
                    </div>
                    <div class="quote-line">
                        <span>Property Size:</span>
                        <span id="quoteSize">Select bedrooms</span>
                    </div>
                    <div class="quote-line">
                        <span>Estimated Time:</span>
                        <span id="quoteTime">-- hours</span>
                    </div>
                    <div class="quote-line">
                        <span>Hourly Rate:</span>
                        <span id="quoteRate">$--/hr</span>
                    </div>
                    <div class="quote-line quote-total">
                        <span>Total Price:</span>
                        <span id="quoteTotal">$0.00</span>
                    </div>
                </div>

                <button id="bookNowBtn" class="book-now-btn" disabled>
                    Complete Form to Book
                </button>

                <div class="quote-details">
                    <p><strong>✅ What's Included:</strong></p>
                    <p>• All cleaning supplies provided<br>
                    • Insured and bonded team<br>
                    • 100% satisfaction guarantee<br>
                    • Same-day confirmation</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Payment Modal -->
    <div id="paymentModal" class="payment-modal">
        <div class="payment-modal-content">
            <div class="payment-header">
                <h2>💳 Complete Your Booking</h2>
                <span class="close-modal" onclick="closePaymentModal()">&times;</span>
            </div>
            
            <div class="payment-booking-summary">
                <div class="summary-line">
                    <span>Service:</span>
                    <span id="paymentService">--</span>
                </div>
                <div class="summary-line">
                    <span>Date & Time:</span>
                    <span id="paymentDateTime">--</span>
                </div>
                <div class="summary-line">
                    <span>Address:</span>
                    <span id="paymentAddress">--</span>
                </div>
                <div class="summary-line">
                    <span>Estimated Duration:</span>
                    <span id="paymentDuration">-- hours</span>
                </div>
                <div class="summary-line total-line">
                    <span>Total Amount:</span>
                    <span id="paymentTotal">$0.00</span>
                </div>
            </div>
            
            <div class="payment-methods">
                <h3>Choose Payment Method:</h3>
                
                <div class="payment-method" data-method="card">
                    <input type="radio" name="payment" value="card" id="cardPayment">
                    <label for="cardPayment">
                        <strong>💳 Credit/Debit Card</strong><br>
                        <small>Secure online payment with Stripe</small>
                    </label>
                </div>
                
                <div class="payment-method" data-method="paypal">
                    <input type="radio" name="payment" value="paypal" id="paypalPayment">
                    <label for="paypalPayment">
                        <strong>🅿️ PayPal</strong><br>
                        <small>Pay with your PayPal account</small>
                    </label>
                </div>
                
                <div class="payment-method" data-method="later">
                    <input type="radio" name="payment" value="later" id="laterPayment">
                    <label for="laterPayment">
                        <strong>💰 Venmo/Zelle</strong><br>
                        <small>Book now, pay on service day</small>
                    </label>
                </div>
            </div>
            
            <!-- Stripe Payment Form (hidden by default) -->
            <div id="stripe-payment-container" style="display: none;">
                <div class="payment-form-header">
                    <h3>💳 Enter Card Details</h3>
                    <p>Your payment is secured by Stripe</p>
                </div>
                
                <div class="card-input-container">
                    <label for="card-element">Card Information</label>
                    <div id="card-element">
                        <!-- Stripe Elements will create form elements here -->
                    </div>
                    <div id="card-errors" role="alert"></div>
                </div>
                
                <button id="stripe-pay-button" class="stripe-pay-button">
                    Pay $0.00 Now
                </button>
                
                <div id="payment-errors" class="payment-errors" style="display: none;"></div>
                
                <div class="payment-security">
                    <p>🔒 Your payment information is secure and encrypted</p>
                </div>
            </div>
            
            <!-- Regular Pay Button (for non-Stripe payments) -->
            <button id="payButton" class="pay-button" style="display: none;">
                Select Payment Method
            </button>
            
            <div id="payment-success" class="payment-success" style="display: none;"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Maid For Heaven NYC</h3>
                    <p>Professional cleaning services you can trust. We bring heaven to your home with our meticulous attention to detail and eco-friendly approach.</p>
                </div>
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <p>📞 (347) 759-2000</p>
                    <p>📧 orhans@maidforheavennyc.com</p>
                </div>
                <div class="footer-section">
                    <h3>Service Areas</h3>
                    <p>Manhattan • Brooklyn • Queens<br>Bronx • Staten Island</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="js/stripe-payment.js"></script>
    <script>
        // Booking system variables
        let selectedService = null;
        let selectedServicePrice = 0;
        let totalPrice = 0;
        let estimatedHours = 0;
        window.totalPrice = 0;

        // Initialize Stripe when page loads
        let stripeInitialized = false;

        // Service selection
        document.querySelectorAll('.service-option').forEach(option => {
            option.addEventListener('click', function() {
                // Remove selected class from all options
                document.querySelectorAll('.service-option').forEach(opt => opt.classList.remove('selected'));
                
                // Add selected class to clicked option
                this.classList.add('selected');
                
                // Store selected service data
                selectedService = this.dataset.service;
                selectedServicePrice = parseInt(this.dataset.price);
                
                // Update quote display
                updateQuote();
                checkFormCompletion();
            });
        });

        // Form field change listeners
        document.getElementById('bedrooms').addEventListener('change', function() {
            updateQuote();
            checkFormCompletion();
        });

        document.getElementById('bathrooms').addEventListener('change', function() {
            updateQuote();
            checkFormCompletion();
        });

        // Other form fields
        ['date', 'time', 'address', 'name', 'email', 'phone'].forEach(fieldId => {
            document.getElementById(fieldId).addEventListener('input', checkFormCompletion);
            document.getElementById(fieldId).addEventListener('change', checkFormCompletion);
        });

        function updateQuote() {
            const bedrooms = document.getElementById('bedrooms').value;
            const bathrooms = document.getElementById('bathrooms').value;
            
            if (!selectedService || !bedrooms || !bathrooms) {
                return;
            }
            
            // Calculate estimated hours based on property size
            estimatedHours = calculateEstimatedHours(bedrooms, bathrooms, selectedService);
            
            // Calculate total price
            totalPrice = selectedServicePrice * estimatedHours;
            window.totalPrice = totalPrice;
            
            // Update display
            document.getElementById('quoteService').textContent = getServiceName(selectedService);
            document.getElementById('quoteSize').textContent = getPropertySize(bedrooms, bathrooms);
            document.getElementById('quoteTime').textContent = estimatedHours + ' hours';
            document.getElementById('quoteRate').textContent = '$' + selectedServicePrice + '/hr';
            document.getElementById('quoteTotal').textContent = '$' + totalPrice.toFixed(2);
        }

        function calculateEstimatedHours(bedrooms, bathrooms, service) {
            let baseHours = 0;
            
            // Base hours by bedroom count
            switch(bedrooms) {
                case 'studio': baseHours = 2; break;
                case '1br': baseHours = 2.5; break;
                case '2br': baseHours = 3; break;
                case '3br': baseHours = 4; break;
                case '4br': baseHours = 5; break;
                case '5br': baseHours = 6; break;
            }
            
            // Add time for bathrooms
            const bathroomCount = parseFloat(bathrooms);
            baseHours += (bathroomCount - 1) * 0.5;
            
            // Adjust for service type
            if (service === 'deep') {
                baseHours *= 1.5;
            } else if (service === 'moveout') {
                baseHours *= 1.8;
            }
            
            return Math.ceil(baseHours * 2) / 2; // Round to nearest 0.5
        }

        function getServiceName(service) {
            switch(service) {
                case 'standard': return 'Standard Cleaning';
                case 'deep': return 'Deep Cleaning';
                case 'moveout': return 'Move-Out Cleaning';
                default: return 'Select service';
            }
        }

        function getPropertySize(bedrooms, bathrooms) {
            const bedroomText = bedrooms.replace('br', ' BR').replace('studio', 'Studio');
            return bedroomText + ', ' + bathrooms + ' Bath';
        }

        function checkFormCompletion() {
            const requiredFields = ['bedrooms', 'date', 'time', 'address', 'name', 'email', 'phone'];
            const bookNowBtn = document.getElementById('bookNowBtn');
            
            let missingFields = [];
            
            // Check service selection
            if (!selectedService) {
                missingFields.push('Service Type');
            }
            
            // Check required form fields
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    missingFields.push(field.previousElementSibling.textContent.replace(':', ''));
                }
            });
            
            if (missingFields.length === 0) {
                bookNowBtn.disabled = false;
                bookNowBtn.textContent = 'Book Now & Pay Online';
                bookNowBtn.classList.remove('disabled');
            } else {
                bookNowBtn.disabled = true;
                if (missingFields.length <= 3) {
                    bookNowBtn.textContent = 'Complete: ' + missingFields.join(', ');
                } else {
                    bookNowBtn.textContent = 'Complete Form to Book (' + missingFields.length + ' fields)';
                }
                bookNowBtn.classList.add('disabled');
            }
        }

        // Book Now button click
        document.getElementById('bookNowBtn').addEventListener('click', function() {
            if (!this.disabled) {
                openPaymentModal();
            }
        });

        function openPaymentModal() {
            // Populate payment modal with booking details
            document.getElementById('paymentService').textContent = getServiceName(selectedService);
            
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            document.getElementById('paymentDateTime').textContent = formatDateTime(date, time);
            
            document.getElementById('paymentAddress').textContent = document.getElementById('address').value;
            document.getElementById('paymentDuration').textContent = estimatedHours + ' hours';
            document.getElementById('paymentTotal').textContent = '$' + totalPrice.toFixed(2);
            
            // Show modal
            document.getElementById('paymentModal').style.display = 'flex';
            
            // Reset payment method selection
            document.querySelectorAll('input[name="payment"]').forEach(radio => {
                radio.checked = false;
            });
            document.querySelectorAll('.payment-method').forEach(method => {
                method.classList.remove('selected');
            });
            
            // Hide payment forms initially
            document.getElementById('stripe-payment-container').style.display = 'none';
            document.getElementById('payButton').style.display = 'none';
            
            updatePayButton();
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').style.display = 'none';
        }

        function formatDateTime(date, time) {
            const dateObj = new Date(date);
            const dateStr = dateObj.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            let timeStr = '';
            switch(time) {
                case 'morning': timeStr = '8:00 AM - 12:00 PM'; break;
                case 'afternoon': timeStr = '12:00 PM - 5:00 PM'; break;
                case 'evening': timeStr = '5:00 PM - 8:00 PM'; break;
            }
            
            return dateStr + ', ' + timeStr;
        }

        // Payment method selection
        document.querySelectorAll('.payment-method').forEach(method => {
            method.addEventListener('click', async function() {
                // Remove selected class from all methods
                document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                
                // Add selected class to clicked method
                this.classList.add('selected');
                
                // Check the radio button
                const radio = this.querySelector('input[type="radio"]');
                radio.checked = true;
                
                const paymentMethod = radio.value;
                
                // Show appropriate payment form
                if (paymentMethod === 'card') {
                    // Show Stripe payment form
                    document.getElementById('stripe-payment-container').style.display = 'block';
                    document.getElementById('payButton').style.display = 'none';
                    
                    // Initialize Stripe if not already done
                    if (!stripeInitialized) {
                        await initializeStripe();
                        stripeInitialized = true;
                    }
                    
                    // Update Stripe pay button text
                    const stripePayButton = document.getElementById('stripe-pay-button');
                    if (stripePayButton) {
                        stripePayButton.textContent = `Pay $${totalPrice.toFixed(2)} Now`;
                    }
                } else {
                    // Show regular pay button for other methods
                    document.getElementById('stripe-payment-container').style.display = 'none';
                    document.getElementById('payButton').style.display = 'block';
                    updatePayButton();
                }
            });
        });

        async function initializeStripe() {
            try {
                if (window.stripePaymentHandler) {
                    await window.stripePaymentHandler.initializeStripeElements();
                    
                    // Add click handler to Stripe pay button
                    const stripePayButton = document.getElementById('stripe-pay-button');
                    if (stripePayButton) {
                        stripePayButton.addEventListener('click', async function(e) {
                            e.preventDefault();
                            await processStripePayment();
                        });
                    }
                }
            } catch (error) {
                console.error('Error initializing Stripe:', error);
                alert('Error initializing payment system. Please try again or choose a different payment method.');
            }
        }

        async function processStripePayment() {
            const bookingData = {
                service: selectedService,
                bedrooms: document.getElementById('bedrooms').value,
                bathrooms: document.getElementById('bathrooms').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                address: document.getElementById('address').value,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                instructions: document.getElementById('instructions').value,
                totalPrice: totalPrice,
                estimatedHours: estimatedHours
            };

            try {
                const success = await window.stripePaymentHandler.processPayment(bookingData);
                if (success) {
                    console.log('✅ Stripe payment successful!');
                }
            } catch (error) {
                console.error('❌ Stripe payment error:', error);
            }
        }

        function updatePayButton() {
            const payButton = document.getElementById('payButton');
            const selectedPayment = document.querySelector('input[name="payment"]:checked');
            
            if (selectedPayment && payButton.style.display !== 'none') {
                const method = selectedPayment.value;
                if (method === 'later') {
                    payButton.textContent = 'Book Now and Pay Later';
                } else if (method === 'paypal') {
                    payButton.textContent = 'Pay with PayPal';
                } else {
                    payButton.textContent = 'Select Payment Method';
                }
                payButton.disabled = false;
            }
        }

        // Regular payment button click (for non-Stripe payments)
        document.getElementById('payButton').addEventListener('click', function() {
            const selectedPayment = document.querySelector('input[name="payment"]:checked');
            if (selectedPayment) {
                const method = selectedPayment.value;
                
                if (method === 'later') {
                    // Book now, pay later
                    alert('🎉 Booking Confirmed!\n\nBooking ID: #MFH' + Date.now() + '\n\nWe will contact you within 24 hours to confirm details and arrange payment.\n\nThank you for choosing Maid For Heaven NYC!');
                    closePaymentModal();
                    setTimeout(() => location.reload(), 2000);
                } else if (method === 'paypal') {
                    // PayPal payment (you can integrate PayPal SDK here)
                    alert('PayPal integration coming soon! Please choose Credit Card or Pay Later option.');
                }
            }
        });

        // Initialize booking system
        function initializeBookingSystem() {
            console.log('Initializing booking system...');
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').setAttribute('min', today);
            
            console.log('✅ Booking system initialized');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeBookingSystem);

        // Close modal when clicking outside
        document.getElementById('paymentModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePaymentModal();
            }
        });
    </script>

</body>
</html>

